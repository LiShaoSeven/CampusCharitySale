<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>校园义卖性价比模拟系统</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "微软雅黑", "Microsoft YaHei", sans-serif;
        }
        body {
            max-width: 1400px;
            margin: 20px auto;
            padding: 0 20px;
            background-color: #f0f2f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }
        h1 {
            text-align: center;
            color: #1f2937;
            margin-bottom: 30px;
            font-size: 24px;
            font-weight: 600;
        }
        h2 {
            color: #1f2937;
            font-size: 18px;
            margin: 20px 0 15px;
            border-left: 4px solid #2563eb;
            padding-left: 10px;
        }
        /* 场景参数样式 */
        .scene-params {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8fafc;
            border-radius: 8px;
        }
        .param-item {
            flex: 1;
            min-width: 150px;
        }
        .param-item label {
            display: block;
            margin-bottom: 8px;
            color: #4b5563;
            font-weight: 500;
        }
        .param-item input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }
        /* 按钮样式 */
        .btn-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .add-btn, .calculate-btn, .reset-btn, .custom-sim-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }
        .add-btn {
            background-color: #2563eb;
            color: white;
        }
        .add-btn:hover {
            background-color: #1d4ed8;
        }
        .calculate-btn {
            background-color: #10b981;
            color: white;
        }
        .calculate-btn:hover {
            background-color: #059669;
        }
        .reset-btn {
            background-color: #6b7280;
            color: white;
        }
        .reset-btn:hover {
            background-color: #4b5563;
        }
        .custom-sim-btn {
            background-color: #f59e0b;
            color: white;
        }
        .custom-sim-btn:hover {
            background-color: #d97706;
        }
        /* 表格样式 */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #e5e7eb;
            padding: 12px;
            text-align: center;
        }
        th {
            background-color: #2563eb;
            color: white;
            font-weight: 500;
        }
        tr:nth-child(even) {
            background-color: #f8fafc;
        }
        input {
            width: 100%;
            padding: 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            text-align: center;
            font-size: 14px;
        }
        .result-cell {
            color: #2563eb;
            font-weight: bold;
        }
        /* 自定义顺序样式 */
        .custom-sort-area {
            background-color: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .custom-sort-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            margin-bottom: 10px;
            font-size: 14px;
        }
        .custom-tips {
            color: #6b7280;
            font-size: 12px;
            margin-top: 5px;
        }
        /* 结果展示样式 */
        .result-section {
            margin-top: 30px;
        }
        .sort-result, .simulation-result {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .sort-result h3, .simulation-result h3 {
            color: #2563eb;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .sort-list {
            line-height: 2;
            font-size: 14px;
        }
        .chart-container {
            width: 100%;
            height: 400px;
            margin-top: 20px;
        }
        .profit-diff {
            color: #10b981;
            font-weight: bold;
            font-size: 16px;
            margin-top: 10px;
        }
        .capacity-tips {
            color: #dc2626;
            font-size: 14px;
            margin-top: 10px;
        }
        .simulate-tips {
            color: #2563eb;
            font-size: 14px;
            margin-top: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>校园义卖性价比模拟系统</h1>

        <!-- 场景参数设置区（匹配C++的SaleParams） -->
        <h2>一、义卖场景参数</h2>
        <div class="scene-params">
            <div class="param-item">
                <label for="totalTime">义卖总时长（分钟）</label>
                <input type="number" id="totalTime" value="120" min="1" step="1">
            </div>
            <div class="param-item">
                <label for="customersPerUnit">客流量（人/分钟）</label>
                <input type="number" id="customersPerUnit" value="5" min="0.1" step="0.1">
            </div>
            <div class="param-item">
                <label for="maxPurchases">单客限购数（件/人）</label>
                <input type="number" id="maxPurchases" value="2" min="1" step="1">
            </div>
            <div class="param-item">
                <label for="stallCapacity">摊位最大容量（件商品）</label>
                <input type="number" id="stallCapacity" value="6" min="1" step="1">
            </div>
            <div class="param-item">
                <label for="numSimulations">模拟次数</label>
                <input type="number" id="numSimulations" value="200" min="1" step="1">
            </div>
        </div>

        <!-- 商品参数表格 -->
        <h2>二、商品参数</h2>
        <div class="btn-group">
            <button class="add-btn" onclick="addRow()">+ 添加商品行</button>
            <button class="calculate-btn" onclick="calculateAll()">计算</button>
            <button class="reset-btn" onclick="resetData()">重置默认数据</button>
        </div>
        <table id="goodsTable">
            <thead>
                <tr>
                    <th>商品ID</th>
                    <th>购买概率(l)</th>
                    <th>单件利润(m/元)</th>
                    <th>浏览时间(t/分钟)</th>
                    <th>跳过概率(q)</th>
                    <th>离开概率(r)</th>
                    <th>l×m</th>
                    <th>性价比</th>
                    <th>最优摆放顺序</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><input type="number" value="1" min="1" readonly></td>
                    <td><input type="number" value="0.6" step="0.01" min="0" max="1" onblur="checkSum(this)"></td>
                    <td><input type="number" value="10.0" step="0.01" min="0"></td>
                    <td><input type="number" value="2.5" step="0.01" min="0"></td>
                    <td><input type="number" value="0.3" step="0.01" min="0" max="1" onblur="checkSum(this)"></td>
                    <td><input type="number" value="0.1" step="0.01" min="0" max="1" onblur="checkSum(this)"></td>
                    <td class="result-cell"></td>
                    <td class="result-cell"></td>
                    <td class="result-cell"></td>
                </tr>
                <tr>
                    <td><input type="number" value="2" min="1" readonly></td>
                    <td><input type="number" value="0.5" step="0.01" min="0" max="1" onblur="checkSum(this)"></td>
                    <td><input type="number" value="5.0" step="0.01" min="0"></td>
                    <td><input type="number" value="1.5" step="0.01" min="0"></td>
                    <td><input type="number" value="0.35" step="0.01" min="0" max="1" onblur="checkSum(this)"></td>
                    <td><input type="number" value="0.15" step="0.01" min="0" max="1" onblur="checkSum(this)"></td>
                    <td class="result-cell"></td>
                    <td class="result-cell"></td>
                    <td class="result-cell"></td>
                </tr>
                <tr>
                    <td><input type="number" value="3" min="1" readonly></td>
                    <td><input type="number" value="0.4" step="0.01" min="0" max="1" onblur="checkSum(this)"></td>
                    <td><input type="number" value="15.0" step="0.01" min="0"></td>
                    <td><input type="number" value="3.0" step="0.01" min="0"></td>
                    <td><input type="number" value="0.4" step="0.01" min="0" max="1" onblur="checkSum(this)"></td>
                    <td><input type="number" value="0.2" step="0.01" min="0" max="1" onblur="checkSum(this)"></td>
                    <td class="result-cell"></td>
                    <td class="result-cell"></td>
                    <td class="result-cell"></td>
                </tr>
                <tr>
                    <td><input type="number" value="4" min="1" readonly></td>
                    <td><input type="number" value="0.55" step="0.01" min="0" max="1" onblur="checkSum(this)"></td>
                    <td><input type="number" value="8.0" step="0.01" min="0"></td>
                    <td><input type="number" value="2.0" step="0.01" min="0"></td>
                    <td><input type="number" value="0.3" step="0.01" min="0" max="1" onblur="checkSum(this)"></td>
                    <td><input type="number" value="0.15" step="0.01" min="0" max="1" onblur="checkSum(this)"></td>
                    <td class="result-cell"></td>
                    <td class="result-cell"></td>
                    <td class="result-cell"></td>
                </tr>
                <tr>
                    <td><input type="number" value="5" min="1" readonly></td>
                    <td><input type="number" value="0.7" step="0.01" min="0" max="1" onblur="checkSum(this)"></td>
                    <td><input type="number" value="3.0" step="0.01" min="0"></td>
                    <td><input type="number" value="1.0" step="0.01" min="0"></td>
                    <td><input type="number" value="0.2" step="0.01" min="0" max="1" onblur="checkSum(this)"></td>
                    <td><input type="number" value="0.1" step="0.01" min="0" max="1" onblur="checkSum(this)"></td>
                    <td class="result-cell"></td>
                    <td class="result-cell"></td>
                    <td class="result-cell"></td>
                </tr>
                <tr>
                    <td><input type="number" value="6" min="1" readonly></td>
                    <td><input type="number" value="0.3" step="0.01" min="0" max="1" onblur="checkSum(this)"></td>
                    <td><input type="number" value="25.0" step="0.01" min="0"></td>
                    <td><input type="number" value="4.0" step="0.01" min="0"></td>
                    <td><input type="number" value="0.5" step="0.01" min="0" max="1" onblur="checkSum(this)"></td>
                    <td><input type="number" value="0.2" step="0.01" min="0" max="1" onblur="checkSum(this)"></td>
                    <td class="result-cell"></td>
                    <td class="result-cell"></td>
                    <td class="result-cell"></td>
                </tr>
                <tr>
                    <td><input type="number" value="7" min="1" readonly></td>
                    <td><input type="number" value="0.5" step="0.01" min="0" max="1" onblur="checkSum(this)"></td>
                    <td><input type="number" value="12.0" step="0.01" min="0"></td>
                    <td><input type="number" value="2.2" step="0.01" min="0"></td>
                    <td><input type="number" value="0.35" step="0.01" min="0" max="1" onblur="checkSum(this)"></td>
                    <td><input type="number" value="0.15" step="0.01" min="0" max="1" onblur="checkSum(this)"></td>
                    <td class="result-cell"></td>
                    <td class="result-cell"></td>
                    <td class="result-cell"></td>
                </tr>
                <tr>
                    <td><input type="number" value="8" min="1" readonly></td>
                    <td><input type="number" value="0.65" step="0.01" min="0" max="1" onblur="checkSum(this)"></td>
                    <td><input type="number" value="6.5" step="0.01" min="0"></td>
                    <td><input type="number" value="1.8" step="0.01" min="0"></td>
                    <td><input type="number" value="0.25" step="0.01" min="0" max="1" onblur="checkSum(this)"></td>
                    <td><input type="number" value="0.1" step="0.01" min="0" max="1" onblur="checkSum(this)"></td>
                    <td class="result-cell"></td>
                    <td class="result-cell"></td>
                    <td class="result-cell"></td>
                </tr>
            </tbody>
        </table>

        <!-- 自定义顺序模拟区 -->
        <div class="custom-sort-area">
            <h2>三、自定义摆放顺序模拟</h2>
            <input type="text" class="custom-sort-input" id="customSortInput" placeholder="请输入自定义商品ID顺序，用英文逗号分隔（例：5,3,1,6,2,4）">
            <div class="custom-tips">提示：输入的ID需为表格中已存在的商品ID，数量不超过摊位最大容量（当前：6件）</div>
            <button class="custom-sim-btn" onclick="simulateCustomSort()">执行自定义顺序模拟</button>
        </div>

        <!-- 结果展示区 -->
        <div class="result-section">
            <div class="sort-result">
                <h3>最优摆放顺序（数字越小越靠前）：</h3>
                <div class="sort-list" id="sortResult">请先点击「计算」</div>
                <div class="capacity-tips" id="capacityTips"></div>
            </div>

            <div class="simulation-result">
                <h3>利润模拟对比：</h3>
                <div id="simulationText">请先点击计算</div>
                <div class="simulate-tips">模拟规则：多次模拟取平均值</div>
                <div class="profit-diff" id="profitDiff"></div>
                <div class="chart-container" id="profitChart"></div>
            </div>
        </div>
    </div>

    <script>
        // 初始化ECharts实例
        let myChart = echarts.init(document.getElementById('profitChart'));
        // 全局存储商品列表和参数
        let globalGoodsList = [];
        let globalStallCapacity = 6;

        function calculateCustomerProfit(items, maxPurchases) {
            let profit = 0;
            let buyCount = 0;
            let usedTime = 0;
            let isLeave = false;
            
            for (const item of items) {
                // 终止条件：限购已满 / 总浏览时间超5分钟 / 已离开
                if (buyCount >= maxPurchases || usedTime >= 5 || isLeave) break;
                
                usedTime += item.t;
                
                // 跳过概率判断（C++逻辑：跳过则不购买，继续下一个）
                if (Math.random() <= item.q) continue;
                
                // 购买逻辑
                if (Math.random() <= item.l && buyCount < maxPurchases) {
                    profit += item.m;
                    buyCount++;
                }
                
                // 离开概率判断（C++离开逻辑：离开则终止浏览）
                if (Math.random() <= item.r) {
                    isLeave = true;
                    break;
                }
            }
            
            return profit;
        }

        // 模拟一次义卖活动（匹配C++的simulate_sale）
        function simulateSale(params) {
            const totalCustomers = Math.floor(params.customersPerUnit * params.totalTime);
            let totalProfit = 0;
            
            // 计算总浏览时间（如果超过总时长则返回0）
            const totalBrowsingTime = params.items.reduce((sum, item) => sum + item.t, 0);
            if (totalBrowsingTime > params.totalTime) return 0;
            
            // 计算每个顾客的利润贡献
            for (let i = 0; i < totalCustomers; i++) {
                totalProfit += calculateCustomerProfit(params.items, params.maxPurchases);
            }
            
            return totalProfit;
        }

        // 运行多次模拟并计算平均值（匹配C++的run_multiple_simulations）
        function runMultipleSimulations(params) {
            let totalProfit = 0;
            let currentProfit = 0;
            
            for (let i = 0; i < params.numSimulations; i++) {
                currentProfit = simulateSale(params);
                totalProfit += currentProfit;
                console.log(`已完成1次模拟，利润：${currentProfit} 目前总利润:${totalProfit}`);
            }
            
            return Math.round(totalProfit / params.numSimulations);
        }

        // 添加商品行
        function addRow() {
            const table = document.getElementById('goodsTable').querySelector('tbody');
            const lastRow = table.lastElementChild;
            const lastId = parseInt(lastRow.querySelector('td:first-child input').value);
            const newRow = document.createElement('tr');
            
            newRow.innerHTML = `
                <td><input type="number" value="${lastId + 1}" min="1" readonly></td>
                <td><input type="number" step="0.01" min="0" max="1" onblur="checkSum(this)"></td>
                <td><input type="number" step="0.01" min="0"></td>
                <td><input type="number" step="0.01" min="0"></td>
                <td><input type="number" step="0.01" min="0" max="1" onblur="checkSum(this)"></td>
                <td><input type="number" step="0.01" min="0" max="1" onblur="checkSum(this)"></td>
                <td class="result-cell"></td>
                <td class="result-cell"></td>
                <td class="result-cell"></td>
            `;
            table.appendChild(newRow);
        }

        // 校验l+q+r=1
        function checkSum(input) {
            const row = input.closest('tr');
            const l = parseFloat(row.cells[1].querySelector('input').value) || 0;
            const q = parseFloat(row.cells[4].querySelector('input').value) || 0;
            const r = parseFloat(row.cells[5].querySelector('input').value) || 0;
            
            const sum = (l + q + r).toFixed(2);
            if (sum !== '1.00' && l && q && r) {
                alert(`商品ID${row.cells[0].querySelector('input').value}：l+q+r=${sum}，需等于1！`);
            }
        }

        // 重置默认数据
        function resetData() {
            location.reload();
        }

        // 构建C++风格的SaleParams参数对象
        function buildSaleParams(itemsList) {
            return {
                totalTime: parseFloat(document.getElementById('totalTime').value) || 120,
                customersPerUnit: parseFloat(document.getElementById('customersPerUnit').value) || 5,
                maxPurchases: parseInt(document.getElementById('maxPurchases').value) || 2,
                numSimulations: parseInt(document.getElementById('numSimulations').value) || 200,
                items: itemsList // 裁剪后的商品列表
            };
        }

        // 核心计算逻辑
        function calculateAll() {
            const table = document.getElementById('goodsTable').querySelector('tbody');
            const rows = table.querySelectorAll('tr');
            let totalLM = 0;
            const goodsList = [];
            
            // 1. 校验并计算基础参数
            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const id = parseInt(row.cells[0].querySelector('input').value);
                const l = parseFloat(row.cells[1].querySelector('input').value) || 0;
                const m = parseFloat(row.cells[2].querySelector('input').value) || 0;
                const t = parseFloat(row.cells[3].querySelector('input').value) || 0;
                const q = parseFloat(row.cells[4].querySelector('input').value) || 0;
                const r = parseFloat(row.cells[5].querySelector('input').value) || 0;

                if (l === 0 || m === 0 || t === 0 || q === 0 || r === 0) {
                    alert(`商品ID${id}：参数不能为空，请填写完整！`);
                    return;
                }
                if ((l + q + r).toFixed(2) !== '1.00') {
                    alert(`商品ID${id}：l+q+r必须等于1，请修正！`);
                    return;
                }

                const lm = (l * m).toFixed(2);
                row.cells[6].textContent = lm;
                totalLM += parseFloat(lm);
                goodsList.push({
                    id, l, m, t, q, r, lm: parseFloat(lm), row
                });
            }

            // 2. 计算性价比
            goodsList.forEach(goods => {
                const numerator = Math.pow(goods.lm, 2);
                const denominator = goods.t * (goods.q + goods.r * (totalLM / goods.lm));
                const ratio = denominator === 0 ? 0 : (numerator / denominator).toFixed(2);
                goods.ratio = parseFloat(ratio);
                goods.row.cells[7].textContent = ratio;
            });

            // 3. 排序生成摆放顺序
            const optimizedList = [...goodsList].sort((a, b) => b.ratio - a.ratio);
            optimizedList.forEach((goods, index) => {
                goods.row.cells[8].textContent = index + 1;
                goods.rank = index + 1;
            });
            const defaultList = [...goodsList].sort((a, b) => a.id - b.id);

            // 4. 全局存储
            globalGoodsList = goodsList;
            globalStallCapacity = parseInt(document.getElementById('stallCapacity').value) || 6;

            // 5. 展示摆放顺序
            const sortText = optimizedList.map(g => `商品${g.id}（性价比：${g.ratio}）→ 摆放位置${g.rank}`).join('<br>');
            document.getElementById('sortResult').innerHTML = sortText;
            document.getElementById('capacityTips').innerHTML = `摊位容量限制：仅展示前${globalStallCapacity}件商品（ID：${optimizedList.slice(0, globalStallCapacity).map(g => g.id).join(', ')}）`;

            // 6. 裁剪商品列表到摊位容量
            const optimizedListLimit = optimizedList.slice(0, globalStallCapacity);
            const defaultListLimit = defaultList.slice(0, globalStallCapacity);

            // 7. 调用C++风格的模拟函数
            const optimizedParams = buildSaleParams(optimizedListLimit);
            const defaultParams = buildSaleParams(defaultListLimit);
            const optimizedProfit = runMultipleSimulations(optimizedParams);
            const defaultProfit = runMultipleSimulations(defaultParams);

            // 8. 展示结果
            document.getElementById('simulationText').innerHTML = `
                模拟条件：义卖总时长${optimizedParams.totalTime}分钟，客流量${optimizedParams.customersPerUnit}人/分钟<br>
                规则：单客限购${optimizedParams.maxPurchases}件，摊位最大容量${globalStallCapacity}件，模拟次数${optimizedParams.numSimulations}次<br>
                默认排序（按ID）总利润：${defaultProfit}元<br>
                优化排序（按性价比）总利润：${optimizedProfit}元
            `;
            const profitIncrease = optimizedProfit - defaultProfit;
            const increaseRate = defaultProfit === 0 ? 0 : ((profitIncrease / defaultProfit) * 100).toFixed(2);
            document.getElementById('profitDiff').innerHTML = `
                优化排序对比默认排序：利润提升${profitIncrease}元（提升幅度${increaseRate}%）
            `;

            // 9. 渲染图表
            renderChart(optimizedProfit, defaultProfit, null);
        }

        // 自定义顺序模拟
        function simulateCustomSort() {
            if (globalGoodsList.length === 0) {
                alert('请先点击「计算」生成商品数据！');
                return;
            }
            const inputVal = document.getElementById('customSortInput').value.trim();
            if (!inputVal) {
                alert('请输入自定义商品ID顺序！');
                return;
            }
            // 解析输入的ID列表
            const customIdList = inputVal.split(',').map(id => parseInt(id.trim())).filter(id => !isNaN(id));
            // 校验ID是否存在
            const validIds = globalGoodsList.map(g => g.id);
            const invalidIds = customIdList.filter(id => !validIds.includes(id));
            if (invalidIds.length > 0) {
                alert(`输入的商品ID不存在：${invalidIds.join(', ')}，请修正！`);
                return;
            }
            // 校验数量不超过摊位容量
            if (customIdList.length > globalStallCapacity) {
                alert(`自定义顺序的商品数量（${customIdList.length}）超过摊位最大容量（${globalStallCapacity}），请删减！`);
                return;
            }
            // 生成自定义排序的商品列表
            const customList = customIdList.map(id => globalGoodsList.find(g => g.id === id));
            // 重新排序最优/默认列表
            const optimizedList = [...globalGoodsList].sort((a, b) => b.ratio - a.ratio);
            const defaultList = [...globalGoodsList].sort((a, b) => a.id - b.id);
            // 裁剪到摊位容量
            const optimizedListLimit = optimizedList.slice(0, globalStallCapacity);
            const defaultListLimit = defaultList.slice(0, globalStallCapacity);
            const customListLimit = customList.slice(0, globalStallCapacity);
            // 调用模拟函数
            const optimizedParams = buildSaleParams(optimizedListLimit);
            const defaultParams = buildSaleParams(defaultListLimit);
            const customParams = buildSaleParams(customListLimit);
            const optimizedProfit = runMultipleSimulations(optimizedParams);
            const defaultProfit = runMultipleSimulations(defaultParams);
            const customProfit = runMultipleSimulations(customParams);
            // 展示结果
            document.getElementById('simulationText').innerHTML = `
                模拟条件：义卖总时长${optimizedParams.totalTime}分钟，客流量${optimizedParams.customersPerUnit}人/分钟<br>
                规则：单客限购${optimizedParams.maxPurchases}件，摊位最大容量${globalStallCapacity}件，模拟次数${optimizedParams.numSimulations}次<br>
                默认排序（按ID）总利润：${defaultProfit}元<br>
                优化排序（按性价比）总利润：${optimizedProfit}元<br>
                自定义排序总利润：${customProfit}元
            `;
            const customVsOpt = customProfit - optimizedProfit;
            const customVsDef = customProfit - defaultProfit;
            document.getElementById('profitDiff').innerHTML = `
                自定义排序 vs 优化排序：${customVsOpt > 0 ? '提升' : '降低'}${Math.abs(customVsOpt)}元<br>
                自定义排序 vs 默认排序：${customVsDef > 0 ? '提升' : '降低'}${Math.abs(customVsDef)}元
            `;
            // 渲染图表
            renderChart(optimizedProfit, defaultProfit, customProfit);
        }

        // 渲染图表函数
        function renderChart(optimizedProfit, defaultProfit, customProfit) {
            const xAxisData = ['默认排序（按ID）', '优化排序（按性价比）'];
            const seriesData = [defaultProfit, optimizedProfit];
            const seriesColor = ['#94a3b8', '#2563eb'];
            // 新增自定义顺序数据
            if (customProfit !== null) {
                xAxisData.push('自定义排序');
                seriesData.push(customProfit);
                seriesColor.push('#f59e0b');
            }
            // 图表配置
            myChart.setOption({
                title: { text: '义卖利润对比', left: 'center' },
                tooltip: { trigger: 'axis' },
                legend: { data: ['总利润（元）'], left: 'left' },
                xAxis: {
                    type: 'category',
                    data: xAxisData
                },
                yAxis: { type: 'value', name: '利润（元）' },
                series: [{
                    name: '总利润',
                    type: 'bar',
                    data: seriesData,
                    itemStyle: { color: seriesColor },
                    label: { show: true, position: 'top', formatter: '{c}元' }
                }]
            });
        }

        // 初始化图表
        window.onload = function() {
            myChart.setOption({
                title: { text: '义卖利润对比', left: 'center' },
                tooltip: { trigger: 'axis' },
                legend: { data: ['总利润（元）'], left: 'left' },
                xAxis: { type: 'category', data: ['默认排序（按ID）', '优化排序（按性价比）'] },
                yAxis: { type: 'value', name: '利润（元）' },
                series: [{ name: '总利润', type: 'bar', data: [0, 0] }]
            });
        };
    </script>
</body>
</html>
